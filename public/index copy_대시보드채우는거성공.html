<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>덕원농장 도축등급관리</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* 스크롤 막대 제거 */
      font-family: sans-serif;
    }
    #top-section {
      padding: 20px;
      box-sizing: border-box;
    }
    iframe {
      width: 100%;
      border: none;
      display: block;
    }
  </style>
</head>
<body>
  <div id="top-section">
    <h1>일자별등판정 xls파일 Upload (upload 후 처리 아직 안만듬)</h1>
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="xlsFile" accept=".xls,.xlsx" required />
      <button type="submit">Upload</button>
    </form>
    <p id="status"></p>
    <h1>대시보드</h1>
  </div>

  <iframe
    id="dashboardFrame"
    src="https://adb-3997551919284009.9.azuredatabricks.net/embed/dashboardsv3/01f0bba8df9b1c0ebcf5dc38714d79aa?o=3997551919284009"
  ></iframe>

  <script>
    function resizeDashboard() {
      const topSection = document.getElementById("top-section");
      const dashboardFrame = document.getElementById("dashboardFrame");

      const topHeight = topSection.offsetHeight;
      const windowHeight = window.innerHeight;

      dashboardFrame.style.height = `${windowHeight - topHeight}px`;
    }

    window.addEventListener("load", resizeDashboard);
    window.addEventListener("resize", resizeDashboard);

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch("/upload", {
        method: "POST",
        body: formData,
      });
      const result = await res.json();
      document.getElementById("status").textContent = result.message;
      resizeDashboard(); // 업로드 후에도 높이 재조정
    });
  </script>
</body>
</html>